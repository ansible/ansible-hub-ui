language: node_js
sudo: required
notifications:
  email: false
  slack:
    rooms:
      - secure: juuizlfiQolXbqy4L2nfODB1K8xiSGvUrzsT3XeXIsQqX7yCYVvnRUssKLbqgLM9m85kgXJk1ef0qwjJoliNqGcrALTZLHPTkxWwTnV7tPEVS/4uQPSyy+DDHDwrTzCrF3qhCqyKJ6vB18z22qm3qLgStmNj4p1ZLznsdJR/u7U3spJ+WLL70QSNHCQy/5QjRDDiR3oqWdXjhVcUCeV+v/2CtfqK3dqYtzCL/b7z8lm/YbV6w1Rd8mwzTgLstbzjrvR/gq2IPALzzJTq1S8lXtV7ZtbYz4bjB8RNCRZFJrjBUH4CqD1oUskit4RRe+ilVs8qNQh0Tt3whsOdbJoRXJn2B/NVxppp2WGlODdsuMgfNh5iBocHKN3Qo4mONbstnHFG99Hr7L8GbUugJHEQlrZn1xRyO9ulyVp+hFp8/F088NNyhnd3+lERUPA5/4+HPQh6Ea+PyKq2TR41VoDGcRDBS4VY/6PfLEJzxEBjwRAAemfvtOFTUu2EocuAllPX1vMA4b1j7Wm+Bs7wft6nEcVdftVanfAgx4dNksnaS8zN9II8rdtBci2yXYJ6J+e+REDn/2IrHaUwr0N9BojYc0ePUElDcygW4Kk1oGklHp681j2zhi1Gt7rbuae1C9fD4QHnryx59uVH5NXqDsXI5EbwTJE3zvzRz9SzmyDqV5A=
node_js:
- '10'
install:
- npm ci
jobs:
  include:
  - stage: Deploy cloud.redhat.com
    script: npm run deploy && curl -sSL https://raw.githubusercontent.com/RedHatInsights/insights-frontend-builder-common/master/src/bootstrap.sh | bash -s
    if: tag IS blank
  - stage: Standalone release
    if: tag IS NOT blank
    before_deploy:
      - npm run build-standalone
      - tar -C dist/ -czvf automation-hub-ui-dist.tar.gz .
    deploy:
      provider: releases
      file: automation-hub-ui-dist.tar.gz
      skip_cleanup: true
      api_key:
        secure: "on9iBXtLJjI3x9toeGgpDzCvXQhQKnh2P8KA2CS96rKU2iln1d4Um097YlQAAMcQs9sD+VMW/DCeCvpSsvNQ3pvBK6hLfZC2IIK01BtlJwepb22cX/hl228lKMMwMJCyxT6Nb8oteCYkiImQbnJrqNZf8pfQMs5zF8iyPm2AV3iVh6CPcSpbc4/JmJpTJ8QWoFdPGGmLurvJf64Y1F5L3zUPPDc8571xU5DtjZtrgVBuZVdPsDb0WcBOj0AoPXFQHqz38G11cc7jf+laBdeCxTX2++u94G7aCqfvE0aE6HdeJDunijJamp/JrfM0khO+n4VxMrwa055wI1da7whNCouO9Jmj8XKjcLWmWP2kKLpg1ViZXOtWQ8GyQ6gozLsROYO8CCgVZu5kDlg9ra8ZLZ/rgvH25wO5/QKoXtBZHplekASiT4sDJ5JmmQ0OSQUHLOB7UVbJKHAJkybQ5qv7K7Ifhs67bUkWZbu6w0FXVaMJ0irZOu8zXFDx5lsk2kn+fFXrEOr2kBgHHf5lz/p49Qks4We44dXSv6eJRTJfOrh/vd97UywaElEGH7iEzTPrSsdAp25QjJRG3OXPHJytiJvrfA7hv3dK6hhwr2tSGzNyglTF1git47gt9qbaFSOcro32w6omln/68k699gcUIJbkUzxo6aM0Ygo5FaOwBFY="
      on:
        tags: true
  - stage: Generate package manifest
    script: .travis/update_manifest.sh
    env:
      - secure: "Kgw6EwfMR+eZkpbzNUzXa3wNTBuqTMKYiITcF14K0q6kR9KZSO+nhUr180+VEbq6t+cE+WZwe5ueqFVSe58T8Ou5/Xa3YucRcxx3If3vBA7hw9EajNzROx7BL5rStiwiHvnz+S/p891brti7SAjNTG+0uU83BOtUrjdZQJmETZzekcAfIuCnI19tIjZZ1v4wMu5LEmZcP+Af9CXddnTxlawjIp+3gi6sfSxnz+zwRfavADpygkNQLG4NraK6C8kUcIsEZ9S/3KlHqmHQ9D+U5SAebS6wg78Yp/k/BtaF3x2FN8bpY8Z03N2u1Qyo82nOIsePp3C2xX89Q3R6ZLLpPq0ApSzDPHZ6mTaqW09eee5MwX+muEiJ4/65MxXrRrsEWXz3zCvT4JW2yNNzeNu4Ir3Cx6M2kine+24E8fuQpiiFWwAfvV2y3k2N7hjp1Z8ZNwxpVq+9Myck0h1GKew1d5atUFlvGeKzPffgYbOkSrqi3G8VWM7qIOwOprqcbqXEOFalOZGZtTpERbO2c18HqyXlrydrn5uEPYsPh6/ZWeaSDIwmob0hCS7V3W4yGEd+GLdahRk8d1GBFu52pCQhmqHFFrPlSe1/x7yEqITEaWuZ6VbrmP4leBniHgIf5rg1BelC2GrekJGOAO8oQHMAItz2ip7CxXrKw/7Ymz/YLpQ="
env:
  global:
  - REPO="git@github.com:RedHatInsights/ansible-hub-ui-build.git"
  - REPO_DIR="ansible-hub-ui-build"
  - BRANCH=${TRAVIS_PULL_REQUEST_BRANCH:-$TRAVIS_BRANCH}
  - NODE_OPTIONS="--max-old-space-size=4096 --max_old_space_size=4096"
